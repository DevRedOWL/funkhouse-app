<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdn.rawgit.com/m10l/SmartPlaceholders.js/master/jquery.SmartPlaceholders.js"></script>
    <script src="https://cdn.rawgit.com/guillaumepotier/Parsley.js/master/dist/parsley.min.js"></script>
    <link rel="stylesheet" href="./admin_old.css">
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FH Ticket checket</title>
  </head>
  <body>
    <form id="form" data-parsley-validate>
      <div class="success">
        <p><span class="name">Билет не найден или неправильно введены данные гостя</span></p>
      </div>
      <h1>Ticket checker</h1>
      <fieldset>
        <input
          class="floatlabel"
          id="name"
          type="text"
          placeholder="Имя / Фамилия"
          required
          data-parsley-no-focus
          data-parsley-error-message="Please enter your name."
        />
      </fieldset>
      <fieldset>
        <input type="submit" value="Submit" />
      </fieldset>
    </form>
  </body>
  <script>
    (function () {
      $(".floatlabel").SmartPlaceholders();

      var $form = $("#form"),
        $success = $(".success"),
        $smart = $(".smart-placeholder-wrapper"),
        parsley = $form.parsley();

      function httpGet(theUrl) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", theUrl, false); // false for synchronous request
        xmlHttp.send(null);
        return xmlHttp.responseText;
      }

      $form.submit(function (e) {
        e.preventDefault();
        if (parsley.validationResult == true) {
          var name = $("#name").val();
          var surname = $("#surname").val();
          var tresult = httpGet(`/findTicket?name=${name}&surname=${surname}`);
          try {
            const id = JSON.parse(tresult).id;
            window.open(`/ticket/check?id=${id}`);
          } catch (ex) {
            success(tresult);
          }
          //clearForm(this);
        }
      });

      function success(name) {
        $(".name").text(name);
        $("html, body").animate({ scrollTop: 0 }, 300);
        $success.slideDown().delay(3000).slideUp();
      }

      function clearForm(el) {
        el.reset();
        $smart.removeClass("focused, populated");
      }
    })();
  </script>
</html>
